#/usr/bin/python3

import urllib.request
import urllib.parse
import http.client


http.client.HTTPConnection.debuglevel = 0


class HTTPRedirectHandler(urllib.request.HTTPRedirectHandler):
	def http_error_302(self, req, fp, code, msg, headers):
		return fp
	http_error_301 = http_error_303 = http_error_307 = http_error_302
	

params = urllib.parse.urlencode({'email': 'bmw@example.com', 'action': 'Login'})
handler = urllib.request.HTTPRedirectHandler()
redirect_handler = HTTPRedirectHandler()
cookie_handler = urllib.request.HTTPCookieProcessor()
req = urllib.request.Request('http://192.168.0.243:10800/_ah/login?continue=http%3A//192.168.0.243%3A10800/api/users/current&{}'.format(params))

# Cookie.jar method
#opener = urllib.request.build_opener(handler, cookie_handler)
# Handler method, may user without cookejar
opener = urllib.request.build_opener(redirect_handler, cookie_handler)

f = opener.open(req)
print(cookie_handler.cookiejar)
print(f.getheaders(), f.read().decode('utf-8'))
